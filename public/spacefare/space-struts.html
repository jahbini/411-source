<!DOCTYPE html><base href=/ ><meta content="James A. Hinds: The Celarien's best friend.  I'm not him, I wear glasses" name=author><meta content=text/html charset=UTF-8 http-equiv=Content-Type><meta content="width=device-width,initial-scale=1" name=viewport><title>A Fountainhead of Strategies, techniques and other stuff</title><meta content="Brainstorms, ideas and such" name=description><meta content="brain candy, ideas, strategies, techniques" name=keywords><script>document.styling={palx:"#03c",black:"#000",white:"#fff"}</script><link href=/assets/icons/apple-icon-57x57.png rel=apple-touch-icon sizes=57x57><link href=/assets/icons/apple-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/assets/icons/apple-icon-72x72.png rel=apple-touch-icon sizes=72x72><link href=/assets/icons/apple-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/assets/icons/apple-icon-114x114.png rel=apple-touch-icon sizes=114x114><link href=/assets/icons/apple-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/assets/icons/apple-icon-144x144.png rel=apple-touch-icon sizes=144x144><link href=/assets/icons/apple-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/assets/icons/apple-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/assets/icons/android-icon-192x192.png rel=icon sizes=192x192 type=image/png><link href=/assets/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/assets/icons/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=/assets/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/assets/manifest.json rel=manifest><meta content=#ffffff name=msapplication-TileColor><meta content=/assets/icons/ms-icon-144x144.png name=msapplication-TileImage><meta content=#ffffff name=theme-color><link href=assets/css/vendor.css rel=stylesheet -content--encoding=gzip><link href=assets/css/app.css rel=stylesheet -content--encoding=gzip><link href=assets/icons/favicon.ico rel="shortcut icon" type=image/x-icon><link href=assets/icons/favicon.ico rel=icon type=image/x-icon><script src=allstories.json></script><script src=mystories.json></script><script src=assets/js/vendor.js -content--encoding=gzip -content--type=text/javascript></script><script src=assets/js/app.js -content--encoding=gzip -content--type=text/javascript></script><script>siteHandle="411-source",topDomain="411-source.com",require("initialize")</script><style>#cover{top:0;left:0;position:fixed;background-repeat:no-repeat;background-size:cover;z-index:-1;height:100%;width:100%}</style><script src=assets/seen.min.js></script><div class=fixed style="background:url(/assets/images/hooray-fade2.jpg) no-repeat center fixed;-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH"></div><div class="bg-transparent container-fluid" id=411-source-body><div class=row><header class="align-items-center d-flex d-row justify-content-around w-100" id=header style=height:250px><div><img class=rounded-circle src="http://www.gravatar.com/avatar/c105eda1978979dfb13059b8878ef95d?s=120" style=-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH></div><div></div></header></div><div class=row style=min-height:100vh><div class=row><div class="col col-12 col-md-9" id=storybar><div class="bg-silver u-shadow" id=mainline><header class=c-card__header><h2 class="c-heading c-heading--small">space-struts<div class=c-heading__sub>---</div></h2></header><div class=c-card__body><div class="bg-darken-1 m1"><div class=contents id=bloviation><canvas height=800 id=seen-canvas width=800></canvas><div id=reference></div></div><script>(function() {
  var slice = [].slice,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };
  (() => {
        return $(function() {
          /**
           * Inverts a mat4
           *
           * @param {mat4} out the receiving matrix
           * @param {ReadonlyMat4} a the source matrix
           * @returns {mat4} out
           */
          var B, Origin, Paths, Ratios, _, addToLattice, allPaths, badScene, basis, bigM, bladeScheme, blades, color, colorScheme, context, createEmplace, dot, dumpText, fillColor, g, height, i, inputPath, invert, j, k, latticeOrigin, latticePoint, latticePointCollection, latticePoints, len, newDot, powers, ref, result, rho, rhoShow, scene, seenInverse, seenModels, siggy, slope, start, v;
          try {
            seenInverse = function(m) {
              return m.inverse = invert(new Array(16), m.slice);
            };
            invert = function(out, a) {
              var a00, a01, a02, a03, a10, a11, a12, a13, a20, a21, a22, a23, a30, a31, a32, a33, b00, b01, b02, b03, b04, b05, b06, b07, b08, b09, b10, b11, det;
              a00 = a[0];
              a01 = a[1];
              a02 = a[2];
              a03 = a[3];
              a10 = a[4];
              a11 = a[5];
              a12 = a[6];
              a13 = a[7];
              a20 = a[8];
              a21 = a[9];
              a22 = a[10];
              a23 = a[11];
              a30 = a[12];
              a31 = a[13];
              a32 = a[14];
              a33 = a[15];
              b00 = a00 * a11 - (a01 * a10);
              b01 = a00 * a12 - (a02 * a10);
              b02 = a00 * a13 - (a03 * a10);
              b03 = a01 * a12 - (a02 * a11);
              b04 = a01 * a13 - (a03 * a11);
              b05 = a02 * a13 - (a03 * a12);
              b06 = a20 * a31 - (a21 * a30);
              b07 = a20 * a32 - (a22 * a30);
              b08 = a20 * a33 - (a23 * a30);
              b09 = a21 * a32 - (a22 * a31);
              b10 = a21 * a33 - (a23 * a31);
              b11 = a22 * a33 - (a23 * a32);
              // Calculate the determinant
              det = b00 * b11 - (b01 * b10) + b02 * b09 + b03 * b08 - (b04 * b07) + b05 * b06;
              if (!det) {
                return null;
              }
              det = 1.0 / det;
              out[0] = (a11 * b11 - (a12 * b10) + a13 * b09) * det;
              out[1] = (a02 * b10 - (a01 * b11) - (a03 * b09)) * det;
              out[2] = (a31 * b05 - (a32 * b04) + a33 * b03) * det;
              out[3] = (a22 * b04 - (a21 * b05) - (a23 * b03)) * det;
              out[4] = (a12 * b08 - (a10 * b11) - (a13 * b07)) * det;
              out[5] = (a00 * b11 - (a02 * b08) + a03 * b07) * det;
              out[6] = (a32 * b02 - (a30 * b05) - (a33 * b01)) * det;
              out[7] = (a20 * b05 - (a22 * b02) + a23 * b01) * det;
              out[8] = (a10 * b10 - (a11 * b08) + a13 * b06) * det;
              out[9] = (a01 * b08 - (a00 * b10) - (a03 * b06)) * det;
              out[10] = (a30 * b04 - (a31 * b02) + a33 * b00) * det;
              out[11] = (a21 * b02 - (a20 * b04) - (a23 * b00)) * det;
              out[12] = (a11 * b07 - (a10 * b09) - (a12 * b06)) * det;
              out[13] = (a00 * b09 - (a01 * b07) + a02 * b06) * det;
              out[14] = (a31 * b01 - (a30 * b03) - (a32 * b00)) * det;
              out[15] = (a20 * b03 - (a21 * b01) + a22 * b00) * det;
              return out;
            };
            
            inputPath = "harpo2chico2stan2babe2groucho2";
            inputPath += "harpo3";
            inputPath += "chico2stan2babe2groucho2harpo2";
            inputPath += "chico3";
            inputPath += "stan2babe2groucho2harpo2chico2";
            inputPath += "stan3";
            inputPath += "babe2groucho2harpo2chico2stan2";
            inputPath += "babe3";
            inputPath += "groucho2harpo2chico2stan2babe2";
            inputPath += "groucho3";
            height = 800;
            T = require("halvalla");
            B = require("backbone");
            _ = require("underscore");
            rho = 15 / 1.618033; //set powers[0] to 15
            powers = (function() {
              var j, results;
              results = [];
              for (i = j = 0; j <= 10; i = ++j) {
                results.push(rho = rho * 1.61803398);
              }
              return results;
            })();
            dumpText = function(...text) {
              var j, len, r, t;
              r = "--";
              for (j = 0, len = text.length; j < len; j++) {
                t = text[j];
                if (_.isString(t)) {
                  r += t;
                } else {
                  r += JSON.stringify(t);
                }
                r += " --";
              }
              return $("#reference").append(T.render(T.p(r)));
            };
            rhoShow = T.render(T.div(() => {
              var j;
              for (i = j = 0; j <= 10; i = ++j) {
                T.p(`rho^${i}=${powers[i]}. `);
              }
              return null;
            }));
            //$("#reference").append rhoShow
            Ratios = [2, 1, 0, -1];
            colorScheme = ['#e6194B', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#42d4f4', '#f032e6', '#bfef45', '#fabed4', '#469990', '#dcbeff', '#9A6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1', '#000075', '#a9a9a9', '#ffffff', '#000000'];
            blades = {};
            ref = ["groucho", "harpo", "chico", "stan", "babe"];
            for (i = j = 0, len = ref.length; j < len; i = ++j) {
              basis = ref[i];
              color = seen.Colors.hex(colorScheme[i]);
              color.a = 140;
              slope = i * 2 * Math.PI / 5;
              blades[basis] = {
                angle: i * 72,
                slope: slope,
                points: (function() {
                  var len1, n, results;
                  results = [];
                  for (k = n = 0, len1 = powers.length; n < len1; k = ++n) {
                    v = powers[k];
                    results.push(new seen.P().transform(new seen.Matrix().translate(v).rotz(slope)));
                  }
                  return results;
                })(),
                color: color
              };
            }
            fillColor = seen.Colors.rgb(255, 5, 5);
            newDot = function(theColor = fillColor, text = "origin") {
              var shape;
              //shape = seen.Shapes.text(text, {font: '10px Roboto', cullBackfaces: false, anchor: 'left'}).fill('#000000')
              shape = new seen.Shape('tri', [new seen.Surface([seen.P(4, 0, 0), seen.P(0, -1, 0), seen.P(0, 1, 0)])]);
              return shape.fill(new seen.Material(theColor)).scale(5);
            };
            latticePoint = B.Model.extend();
            latticePointCollection = B.Collection.extend({
              model: latticePoint
            });
            latticePoints = new latticePointCollection();
            addToLattice = function(who, where, what, parent) {
              var badboy, pointFinal, sig;
              try {
                pointFinal = seen.P(0, 0, 0).transform(what.m).round();
                if (!(1000 > pointFinal.magnitude())) {
                  return null;
                }
                sig = siggy(parent, who, where);
                //dumpText "lattice sig", sig, who,parent
                return latticePoints.add({
                  id: what.surfaces[0].id,
                  blade: who,
                  offset: where,
                  pointFinal: pointFinal,
                  signature: sig
                });
              } catch (error) {
                badboy = error;
                return alert("233 " + badboy);
              }
            };
            latticeOrigin = new latticePoint({
              id: "o0",
              blade: "origin",
              offset: 0,
              pointFinal: seen.P(0, 0, 0),
              signature: "_"
            });
            //latticePoints.add latticeOrigin
            dot = null;
            seenModels = new seen.Models.default();
            bladeScheme = ["groucho", "harpo", "chico", "stan", "babe", "groucho", "chico", "babe", "harpo", "stan", "groucho"];
            Paths = class Paths {
              // local p accumulates all Paths to a specific vertex from the origin
              constructor() {
                this.p = {};
              }

              addPath(v, data) {
                var bladesInPath, path, t;
                bladesInPath = t = data.split('/');
                path = _.sortBy(t, function(d) {
                  return d;
                });
                data = path.join('/');
                if (!this.p[v.x]) {
                  this.p[v.x] = {};
                }
                //dumpText JSON.stringify v
                //dumpText data
                if (!(t = this.p[v.x][v.y])) {
                  this.p[v.x][v.y] = [data];
                  return true;
                }
                //return false unless -1 == _.indexOf t, data
                //# this adds more links to vertex lets just try the first in the class
                //t.unshift data
                return true;
              }

              mostPaths() {
                var byXY, byY, max, ref1, x, y;
                max = [];
                ref1 = this.p;
                for (x in ref1) {
                  byY = ref1[x];
                  for (y in byY) {
                    byXY = byY[y];
                    if (byXY.length > max.length) {
                      max.push(byXY);
                    }
                  }
                }
                return {
                  x: x,
                  y: y,
                  max: max
                };
              }

            };
            allPaths = new Paths();
            siggy = function(p, blade, wp) {
              return `${p.get("signature")}/${blade}-${blades[blade].angle}.${wp}`;
            };
            Origin = new seen.Shape('tri', [new seen.Surface([seen.P(0, 4, 0), seen.P(1, 0, 0), seen.P(-1, 0, 0)])]);
            Origin.fill(new seen.Material('#880000')).scale(5);
            seenModels.add(Origin);
            createEmplace = function(parent = latticeOrigin, blade, inputPower = 0) {
              var bladeModel, buildPoint, direction, newPoint, pipeIt;
              direction = 1;
              if (inputPower < 0) {
                direction = -1;
                inputPower = -inputPower;
              }
              bladeModel = seenModels.append();
              buildPoint = function(blade, thePower, theParent) {
                var b, badboy, bb, signature, x, y, z;
                if (!theParent) {
                  return;
                }
                try {
                  ({x, y, z} = theParent.get("pointFinal"));
                  signature = siggy(theParent, blade, thePower);
                  //dumpText "build",signature
                  b = blades[blade];
                  bb = b.points[thePower];
                  dot = newDot(blades[blade].color, signature).rotz(b.slope).translate(bb.x * direction, bb.y * direction, 0).translate(x, y, z);
                  dot.bake().reset();
                  //dumpText "dot", signature, dot
                  bladeModel.add(dot);
                  if (!allPaths.addPath(seen.P(0, 0, 0).transform(dot.m).round(), signature)) {
                    return null;
                  }
                } catch (error) {
                  badboy = error;
                  alert(badboy);
                }
                return addToLattice(blade, thePower, dot, theParent);
              };
              pipeIt = function(s, d, color) {
                var dp, interpolatePoints, ln1, sp;
                interpolatePoints = function(a, b, t) {
                  return seen.P(a.x * (1.0 - t) + b.x * t, a.y * (1.0 - t) + b.y * t, a.z * (1.0 - t) + b.z * t);
                };
                sp = s.get("pointFinal");
                dp = d.get("pointFinal");
                ln1 = seen.Shapes.pipe(interpolatePoints(sp, dp, .9), interpolatePoints(sp, dp, .2));
                ln1.fill(color);
                return bladeModel.add(ln1);
              };
              
              //alert "in create #{blade} #{inputPower}"
              newPoint = buildPoint(blade, inputPower, parent);
              pipeIt(parent, newPoint, colorScheme[inputPower + 5]);
              return newPoint;
            };
            start = latticeOrigin;
            while (inputPath) {
              result = inputPath.match(/(harpo|groucho|chico|stan|babe)(-?[0-9]*)(.*)$/);
              inputPath = result[3];
              //dumpText result
              start = createEmplace(start, result[1], result[2]);
            }
            dumpText("JAH here");
            dumpText(latticePoints.length);
            g = allPaths.mostPaths();
            dumpText("popular destination", g);
            
            //latticePoints.forEach (l)->dumpText l.toJSON()
            //fillColor = seen.Colors.rgb 25,99,188,40
            dumpText("JAH where");
            dumpText("JAH nowhere");
            
            // Create scene and add shape to model
            scene = new seen.Scene({
              model: bigM = seenModels,
              viewport: seen.Viewports.center(height, height),
              camera: new seen.Camera({
                projection: seen.Projections.perspective()
              })
            });
            
            // Create render context from canvas
            context = seen.Context('seen-canvas', scene);
            return context.render();
          } catch (error) {
            
            //dragger = new seen.Drag('seen-canvas', {inertia : true})
            //dragger.on 'drag.rotate', (e) ->
            //  bigM.transform seen.Quaternion.xyToTransform(e.offsetRelative...)
            //  context.render()
            badScene = error;
            return alert("Seenery fail " + badScene);
          }
        });
      })();
})();</script></div></div><footer class=c-card__footer><p class=c-text--quiet>that's all--</footer></div></div><div class="col col-12 col-md-3"><aside id=sidebar style=min-width:240></aside></div><div class="bg-darken-2 flex-auto order-last" id=sidecar style=min-width:240><div class=fb-login-button data-auto-logout-link=true data-button-type=login_with data-max-rows=1 data-show-faces=true data-size=medium data-use-continue-as=true data-width=200 width=200></div><div id=fb-status></div></div></div></div><div class=panel id=footer bg=white><h2>All contents copyright 2015, James A. Hinds</h2></div><div id=cover style=background-image:url(/assets/images/hooray-fade2.jpg);-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH></div></div>