<!DOCTYPE html><html><head><base href="/" /><meta name="author" content="James A. Hinds: The Celarien's best friend.  I'm not him, I wear glasses" /><meta http-equiv="Content-Type" content="text/html" charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>A Fountainhead of Strategies, techniques and other stuff</title><meta name="description" content="Brainstorms, ideas and such" /><meta name="keywords" content="brain candy, ideas, strategies, techniques" /><script>document.styling = {"palx":"#03c","black":"#000","white":"#fff"}</script><link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png" /><link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png" /><link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png" /><link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png" /><link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png" /><link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png" /><link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png" /><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png" /><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png" /><link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png" /><link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png" /><link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png" /><link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png" /><link rel="manifest" href="/assets/manifest.json" /><meta name="msapplication-TileColor" content="#ffffff" /><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png" /><meta name="theme-color" content="#ffffff" /><link rel="stylesheet" href="assets/css/vendor.css" -content--encoding="gzip" /><link rel="stylesheet" href="assets/css/app.css" -content--encoding="gzip" /><link rel="shortcut icon" href="assets/icons/favicon.ico" type="image/x-icon" /><link rel="icon" href="assets/icons/favicon.ico" type="image/x-icon" /><script src="allstories.json"></script><script src="mystories.json"></script><script src="assets/js/vendor.js" -content--type="text/javascript" -content--encoding="gzip"></script><script src="assets/js/app.js" -content--type="text/javascript" -content--encoding="gzip"></script><script>siteHandle = '411-source'; topDomain = '411-source.com'; require('initialize');</script><style>#cover {
top: 0;
left: 0;
position: fixed;
background-repeat: no-repeat;
background-size: cover;
z-index: -1;
height:100%;
width:100%;
}</style><script src="https://aframe.io/releases/0.8.0/aframe.js"></script><script src="draft/peacefare/rollerball-cog/aframe-physics-system.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.7.1/coffee-script.min.js"></script><script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script><script src="https://unpkg.com/aframe-arrow-component@1.0.0/index.js"></script><style type="text/css">a-scene { height: 300px; width: 600px; }
.console {
  background: #fff;
  color: #000;
  padding: 0;
  position: relative;
}
.console * {
  border: 0;
  font: normal 14px/1.3 Consolas,'Andale Mono','Courier New',Courier,monospace;
  margin: 0;
  outline: 0;
  padding: 0;
}
.console textarea {
  background: transparent;
  color: #000;
  display: block;
  overflow: hidden;
  resize: none;
  vertical-align: middle;
  width: 100%;
  word-wrap: normal;
}
.console-container {
  max-height: 100%;
  overflow: auto;
}
.console-container span.string {
  color: #c00;
}
.console-container span.string::before,
.console-container span.string::after {
  color: #333;
  content: '"';
}
.console-container span.number {
  color: #00f;
}
.console-container span.null,
.console-container span.undefined {
  color: #999;
}
.console-container ol.array {
 display: inline-block;
}
.console-container ol.array::before {
  color: #999;
  content: '[';
}
.console-container ol.array::after {
  color: #999;
  content: ']';
}
.console-container ol.array li {
  display: inline-block;
}
.console-container ol.array li::after {
  color: #999;
  content: ',';
}
.console-container ol.array li:last-child::after {
  content: none;
}
.console-container dl.object::before {
  color: #000;
  content: '{';
}
.console-container dl.object::after {
  color: #000;
  content: '}';
  margin-left: 0.5em;
}
.console-container dl {
  display: inline-block;
}
.console-container dl.object dt, .console-container dl.object dd {
  display: inline-block;
}
.console-container dl.object dt {
  color: #909;
  margin-left: 0.5em;
}
.console-container dl.object dt::after {
  color: #000;
  content: ':';
  margin-right: 0.25em;
}
.console-container dl.object dd::after {
  content: ',';
}
.console-container dl.object dd:last-child::after {
  content: none;
}
.console-container div.element div.open,
.console-container div.element div.close {
  color: #909;
  display: inline;
}
.console-container div.element div.open::before {
  content: '<';
}
.console-container div.element div.close::before {
  content: '</';
}
.console-container div.element div.open::after,
.console-container div.element div.close::after {
  content: '>';
}
.console-container div.element div.content {
  display: none;
}
.console-container div.element dl,
.console-container div.element dt,
.console-container div.element dd {
  display: inline;
}
.console-container div.element dt {
  color: #c00;
  margin-left: 0.5em;
}
.console-container div.element dt::after {
  content: '=';
}
.console-container div.element dd {
  color: #00f;
}
.console-container div.element dd::before,
.console-container div.element dd::after {
  color: #c00;
  content: '"';
}
.console-container p {
  padding-left: 15px;
  position: relative;
}
.console-container p::before {
  color: #ccc;
  content: '>';
  left: 0;
  position: absolute;
  text-align: center;
  top: 0;
  vertical-align: middle;
  width: 15px;
}
.console-container p.console-input::before {
  color: #39f;
}
.console-container p div.command {
  color: #39f;
  white-space: pre;
}
.console-container p.error div.result {
  color: #f00;
}</style></head><body onload="Pylon.trigger('loaded')"><div class="fixed" style="background: url(/assets/images/hooray-fade2.jpg) no-repeat center fixed; -moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH "></div><div id="411-source-body" class="container-fluid bg-transparent"><div class="row"></div><div class="row" style="min-height:100vh"><div class="row"><div id="storybar" class="col col-12 col-md-9"><div id="mainline" class="bg-silver u-shadow"><header class="c-card__header"><h2 class="c-heading c-heading--small">low-roller<div class="c-heading__sub">---</div></h2></header><div class="c-card__body"><div class="m1 bg-darken-1"><div id="console0" class="left" data-limit="100"></div><script type="text/javascript">(function() {
  var slice = [].slice,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };
  (function() {
    var C, PID, TetraForcer, V2A, commandByTeam, coordinates, dLay, debug, innieCounter, innieID, isCoordinates, pointToWorldFrame, setEverything;
    window.demo = true;

    /* 
    var CANNON = require('cannon');
     */
    PID = (function() {

      /*
      the PID style of controller is intended to track a quantity from the real world as detected by some sensor.
      The sensor is assumed to be reliable as possible, consistent and acccurate.
      the output of the controller is a single quantity that controls a single output device.
      The output device is related in some fashion to changes in the real world that affect the sensor.
      A PID controller ses the input values to compte an output variable by looking at three internally 
      computed quantities.
      1) the Proportial component, which simply is related to "How far away from our goal are we?"
      2) the Integral component, which is related to "How far have we come to our goal?"
      3) the Differential component, which asks "are we taking big steps, or tiny ones?"
       */
      function PID(proportionalParm, integrationParm, derivativeParm, dt) {
        var integrationLimit, options;
        if (typeof proportionalParm === 'object') {
          options = proportionalParm;
          proportionalParm = options.p;
          integrationParm = options.i;
          derivativeParm = options.d;
          dt = options.rate || 0;
          integrationLimit = options.integrationLimit;
        }
        this.proportionalParm = typeof proportionalParm === 'number' ? proportionalParm : 1;
        this.integrationParm = integrationParm || 0;
        this.derivativeParm = derivativeParm || 0;
        this.dt = dt || 0;
        this.integrationLimit = integrationLimit || 0;
        this.sumDelta = 0;
        this.lastDelta = 0;
        this.setTarget(0);
        return;
      }

      PID.prototype.setTarget = function(target) {
        this.target = target;
        this.lastTime = Date.now();
      };

      PID.prototype.update = function(currentValue) {
        var currentTime, dDelta, delta, dt, ref, sumSign;
        this.currentValue = currentValue;
        dt = this.dt;
        if (!dt) {
          currentTime = Date.now();
          dt = (currentTime - this.lastTime) / 1000;
          this.lastTime = currentTime;
        }
        if (typeof dt !== 'number' || dt === 0) {
          dt = 1;
        }
        delta = this.target - this.currentValue;
        this.sumDelta = this.sumDelta + delta * dt;
        if ((0 <= (ref = this.integrationLimit) && ref < Math.abs(this.sumDelta))) {
          sumSign = this.sumDelta > 0 ? 1 : -1;
          this.sumDelta = sumSign * this.integrationLimit;
        }
        dDelta = (delta - this.lastDelta) / dt;
        this.lastDelta = delta;
        return (this.proportionalParm * delta) + (this.integrationParm * this.sumDelta) + (this.derivativeParm * dDelta);
      };

      PID.prototype.reset = function() {
        this.sumDelta = 0;
        this.lastDelta = 0;
        this.setTarget(0);
      };

      return PID;

    })();

    /*
    * Convert a local body point to world frame.
    * @method pointToWorldFrame
    * @param  {Vec3} localPoint
    * @param  {Vec3} result
    * @return {Vec3}
     */
    pointToWorldFrame = function(body, localPoint, result) {
      if (result == null) {
        result = new CANNON.Vec3();
      }
      body.quaternion.vmult(localPoint, result);
      result.vadd(body.position, result);
      return result;
    };

    /**
     * A tetraForcer, connecting two bodies by four tetrahedral anchors.
     *
     * @class TetraForcer
     * @constructor
     * @param {Body} outie
     * @param {Body} innie
     * @param {Object} [options]
     */
    TetraForcer = (function() {
      var Vec3, applyForce_pursuePoint, applyForce_ri, applyForce_ri_x_f, applyForce_rj, applyForce_rj_x_f, applyForce_tmp, applyForce_worldAnchorA, applyForce_worldAnchorB, innieToPursuit, nullPoint, nullVector, outieToInnie, pursuit, seekPosition, seekVector, tetraPosition, tetraToInnie, tetraToSeekPostion, toInnie;

      function TetraForcer(outie, innie1, options) {
        var i, j, p;
        this.outie = outie;
        this.innie = innie1;
        if (options == null) {
          options = {};
        }

        /**
         * debug by showning marker and computed forces
         */
        this.debug = options.debug || false;

        /**
         * Proportional, Integral, Differential parameters
         * @property pid
         * @type {object}
         */
        p = options.pid || {};
        p.p = p.p || 40;
        p.i = p.i || 40;
        p.d = p.d || 0.4;
        p.rate = p.rate || 1 / 60.0;
        this.pIDs = [];
        for (i = j = 0; j <= 3; i = ++j) {
          this.pIDs.push(new PID(p));
        }

        /**
         * min force
         * resting force
         * @property minForce
         * @type {number}
         */
        this.minForce = options.minForce || 10;
        this.equations = [];
        return;
      }


      /**
       * Set the anchor point on body A, using world coordinates.
       * @method setWorldAnchorA
       * @param {Vec3} worldAnchorA
       */

      TetraForcer.prototype.setWorldAnchorA = function(worldAnchorA) {
        this.outie.pointToLocalFrame(worldAnchorA, this.localAnchorA);
      };


      /**
       * Set the anchor point on body B, using world coordinates.
       * @method setWorldAnchorB
       * @param {Vec3} worldAnchorB
       */

      TetraForcer.prototype.setWorldAnchorB = function(worldAnchorB) {
        this.innie.pointToLocalFrame(worldAnchorB, this.localAnchorB);
      };


      /**
       * Get the anchor point on body A, in world coordinates.
       * @method getWorldAnchorA
       * @param {Vec3} result The vector to store the result in.
       */

      TetraForcer.prototype.getWorldAnchorA = function(result) {
        pointToWorldFrame(this.outie, this.localAnchorA, result);
      };


      /**
       * Get the anchor point on body B, in world coordinates.
       * @method getWorldAnchorB
       * @param {Vec3} result The vector to store the result in.
       */

      TetraForcer.prototype.getWorldAnchorB = function(result) {
        pointToWorldFrame(this.innie, this.localAnchorB, result);
      };

      Vec3 = CANNON.Vec3;

      pursuit = new Vec3();

      seekVector = new Vec3();

      seekPosition = new Vec3();

      tetraPosition = new Vec3();

      tetraToSeekPostion = new Vec3();

      toInnie = new Vec3();

      innieToPursuit = new Vec3();

      tetraToInnie = new Vec3();

      applyForce_ri = new Vec3();

      applyForce_rj = new Vec3();

      applyForce_ri_x_f = new Vec3();

      applyForce_rj_x_f = new Vec3();

      applyForce_tmp = new Vec3();

      applyForce_pursuePoint = new Vec3();

      applyForce_worldAnchorA = new Vec3();

      applyForce_worldAnchorB = new Vec3();

      outieToInnie = new Vec3();

      nullVector = nullPoint = new Vec3();


      /**
       * Apply the linearMotor force to the connected bodies.
       * @method applyForce
       */

      TetraForcer.prototype.update = function() {
        var adjust, direction, dt, force, inf, innieID, innieLocalPosition, innieNextL, innieNextW, innieNullPointW, innieStopForce, innieToSeekDistance, j, len, otf, outieLimitW, outieToInnieLimitR, outieToInnieNextR, pursue, ref, seekPositionL, seekPositionW, tet, tetToInnieDistance, tetToSeekDistance, tetW, tetraLength, tetraStruct, tetraVector;
        dt = 0.0166;
        pursue = this.outie.el.pursuit();
        outieLimitW = this.outie.radius * 0.9;
        seekPositionW = this.outie.position.vadd((pursue.vsub(this.outie.position)).unit().scale(outieLimitW));
        seekPositionL = this.outie.pointToLocalFrame(seekPositionW);
        if (this.type === 'tetraPositioner') {
          this.innie.position.copy(this.outie.pointToWorldFrame(seekPositionL));
          this.innie.velocity.copy(this.innie.initVelocity);
          this.outie.applyForce(new Vec3(0, -9.6 * this.innie.mass, 0.1), this.innie.position.vsub(this.outie.position));
          return;
        }
        outieToInnieLimitR = (this.outie.position.distanceTo(this.innie.position)) / this.outie.radius;
        innieNextW = this.innie.position.vadd(this.innie.velocity.scale(dt));
        outieToInnieNextR = (this.outie.position.distanceTo(innieNextW)) / this.outie.radius;
        innieNextL = this.outie.pointToLocalFrame(innieNextW);
        innieStopForce = this.innie.velocity.scale(-this.innie.mass * dt);
        innieLocalPosition = this.outie.pointToLocalFrame(this.innie.position);
        innieToSeekDistance = innieLocalPosition.distanceTo(seekPositionL);
        ref = this.outie.tetraPoints;
        for (j = 0, len = ref.length; j < len; j++) {
          tetraStruct = ref[j];
          tet = tetraStruct.cannonLocal.scale(this.outie.radius);
          tetW = pointToWorldFrame(this.outie, tet);
          innieNullPointW = pointToWorldFrame(this.innie, nullPoint);
          tetraVector = tetW.vsub(this.innie.position);
          tetraLength = tetraVector.length();
          tetToSeekDistance = tetW.distanceTo(seekPositionW);
          tetToInnieDistance = tetW.distanceTo(this.innie.position);
          force = this.minForce * this.innie.mass;
          adjust = this.pIDs[tetraStruct.index].update(tetToSeekDistance - tetToInnieDistance);
          force += adjust;
          direction = tetraVector.unit();
          this.outie.applyForce(tetraVector.unit().scale(-force), tetW.vsub(this.outie.position));
          this.innie.applyForce(tetraVector.unit().scale(force), innieNullPointW.vsub(this.innie.position));
          if (!this.debug) {
            continue;
          }
          innieID = this.innie.el.id;
          inf = document.querySelector("#" + innieID + "__marker");
          inf.setAttribute("position", seekPositionW);
          inf = document.querySelector("#" + innieID + "__innieForce__" + tetraStruct.index);
          inf.setAttribute("position", this.innie.position);
          inf.setAttribute("arrow", "direction: " + direction.x + " " + direction.y + " " + direction.z + "; length: " + (force / 10));
          otf = document.querySelector("#" + innieID + "__outieForce__" + tetraStruct.index);
          otf.setAttribute("position", tetW);
          otf.setAttribute("arrow", "direction: " + (-1 * direction.x) + " " + (-1 * direction.y) + " " + (-1 * direction.z) + "; length: " + (force / 10));
        }
      };

      return TetraForcer;

    })();

    /*
     * Register the component with the A-Frame system
     * decode and pass options along
     *
     */
    AFRAME.registerComponent('tetra-motor', {
      multiple: false,
      schema: {
        type: {
          oneOf: ['tetraPositioner', 'tetraForcer']
        },
        debug: {
          type: 'boolean',
          "default": false
        },
        target: {
          type: 'selector'
        },
        minForce: {
          "default": 10,
          min: 0
        },
        maxForce: {
          "default": 1e6,
          min: 0
        },
        collideConnected: {
          "default": true
        },
        wakeUpBodies: {
          "default": true
        },
        pid: {
          type: 'array',
          "default": [200, 100, 1]
        },
        restLength: {
          type: 'number',
          "default": 0
        },
        localAnchor: {
          type: 'vec3',
          "default": {
            x: 0,
            y: 0,
            z: 0
          }
        },
        localTarget: {
          type: 'vec3',
          "default": {
            x: 0,
            y: 0,
            z: 0
          }
        }
      },
      init: function() {
        this.system = this.el.sceneEl.systems.physics;
        this.constraint = null;
      },
      remove: function() {
        if (!this.constraint) {
          return;
        }
        this.system.removeConstraint(this.constraint);
        this.constraint = null;
      },
      update: function() {
        var data, el, ref;
        el = this.el;
        data = this.data;
        this.remove();
        if (!el.body || !((ref = data.target) != null ? ref.body : void 0)) {
          (el.body ? data.target : el).addEventListener('body-loaded', this.update.bind(this, {}));
          return;
        }
        this.constraint = this.createConstraint();
        this.system.addConstraint(this.constraint);
      },
      createConstraint: function() {
        var constraint, data, lA, lB;
        constraint = void 0;
        data = this.data;
        constraint = void 0;
        data.type = 'tetraForcer';
        switch (data.type) {
          case 'tetraForcer' || 'tetraPositioner':
            lA = this.data.localAnchor;
            lB = this.data.localTarget;
            constraint = new TetraForcer(this.el.body, data.target.body, {
              pid: {
                p: data.pid[0],
                i: data.pid[1],
                d: data.pid[2],
                dt: 0.016
              },
              debug: data.debug,
              minForce: this.data.minForce
            });
            constraint.type = 'tetraMotor';
            break;
          default:
            throw new Error('[constraint] Unexpected type: ' + data.type);
        }
        return constraint;
      }
    });
    setEverything = function(e, attributes, hash) {
      var a, v;
      if (hash == null) {
        hash = {};
      }
      for (a in attributes) {
        v = attributes[a];
        e.setAttribute(a, v);
      }
      for (a in hash) {
        v = hash[a];
        e[a] = v;
      }
      if (e.updateProperties != null) {
        e.updateProperties();
      }
    };
    innieCounter = 0;
    innieID = function() {
      return "innie__" + (++innieCounter);
    };
    dLay = function(f) {
      return setTimeout(f, 0);
    };
    V2A = function(position) {
      return position.x + " " + position.y + " " + position.z;
    };
    C = function(x, y, z) {
      if (x == null) {
        x = 0;
      }
      if (y == null) {
        y = 0;
      }
      if (z == null) {
        z = 0;
      }
      return new CANNON.Vec3(x, y, z);
    };
    debug = AFRAME.utils.debug;
    coordinates = AFRAME.utils.coordinates;
    isCoordinates = coordinates.isCoordinates || coordinates.isCoordinate;
    AFRAME.registerComponent('lowroller', {
      schema: {
        inner: {
          type: 'number',
          "default": 9
        },
        outer: {
          type: 'number',
          "default": 1
        },
        debug: {
          type: 'boolean',
          "default": false
        },
        pid: {
          type: 'array',
          "default": [200, 100, 1]
        },
        pursuit: {
          "default": 'self',
          parse: function(value) {
            if (isCoordinates(value) || typeof value === 'object') {
              return coordinates.parse(value);
            }
            return value;
          },
          stringify: function(data) {
            if (typeof data === 'object') {
              return coordinates.stringify(data);
            }
            return data;
          }
        }
      },
      controlPoints: [],

      /*
      iterate over the four tetrahedral control points
       */
      accessControlPoints: function(f) {
        var element, j, len, ref, results;
        ref = this.controlPoints;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          element = ref[j];
          results.push(f(element));
        }
        return results;
      },

      /*
      setPursuit aims the low-roller at this xy destination
       */
      setPursuit: function(p) {
        var m, targetEl;
        console.log("Setting pursuit");
        if (!this.el.body) {
          this.el.addEventListener('body-loaded', (function(_this) {
            return function(event) {
              return _this.setPursuit(p);
            };
          })(this));
          return;
        }
        this.pursuitVector.copy(this.el.body.position);
        this.el.pursuit = (function(_this) {
          return function() {
            return _this.pursuitVector;
          };
        })(this);
        if (p === 'self' || p === 'idle') {
          return;
        }
        if (typeof p === 'object') {
          this.pursuitVector.copy({
            x: p.x,
            y: 0,
            z: p.y
          });
          return;
        }
        if (m = p.trim().match(/(-?[\d.]+)[,\s]+(-?[\d.]+)([,\s]+(-?[\d.]+))?/)) {
          this.pursuitVector.copy({
            x: m[1],
            y: 0,
            z: m[2]
          });
          return;
        }
        targetEl = this.el.sceneEl.querySelector(p);
        if (!targetEl) {
          return;
        }
        if (!targetEl.hasLoaded) {
          targetEl.addEventListener('loaded', (function(_this) {
            return function() {
              _this.setPursuit(p);
            };
          })(this));
          return;
        }
        if (targetEl.body) {
          this.el.pursuit = function() {
            return targetEl.body.position;
          };
          return;
        }
        this.el.pursuit = (function(_this) {
          return function() {
            debugger;
            _this.pursuitVector.copy(targetEl.components.position.data);
            return _this.pursuitVector;
          };
        })(this);
      },

      /*
      Initialization
       */
      init: function() {
        var colors, data, innie, marker, position, radius, scale, tetrahedralDescription, v;
        this.initRuntime = true;
        tetrahedralDescription = [];
        (function() {
          var j, k, len, len1, r, y, z;
          r = [1, -1];
          for (j = 0, len = r.length; j < len; j++) {
            z = r[j];
            for (k = 0, len1 = r.length; k < len1; k++) {
              y = r[k];
              tetrahedralDescription.push({
                p: new THREE.Vector3(z * y, y, z),
                normed: (new THREE.Vector3(z * y, y, z)).normalize(),
                raw: [z * y, y, z],
                cannonLocal: (C(z * y, y, z)).unit(),
                index: tetrahedralDescription.length,
                flip: 1
              });
            }
          }
        })();

        /*
        tetrahedron init
         */
        this.tetrahedralDescription = tetrahedralDescription;
        data = this.data;
        this.pursuitVector = C();
        this.setPursuit(this.data.pursuit);
        radius = this.el.components.geometry.data.radius;
        scale = this.el.components.geometry.data.scale;
        this.totalMass = data.inner + data.outer;
        position = this.el.components.position.data;
        this.el.addEventListener('body-loaded', (function(_this) {
          return function(event) {
            var body;
            body = event.currentTarget.body;
            body.velocity.set(0, 0, 0);
            body.angularVelocity.set(0, 0, 0);
            body.quaternion = body.initQuaternion;
            body.radius = _this.el.components.geometry.data.radius;
            body.tetraPoints = tetrahedralDescription;
            body.updateProperties();
          };
        })(this));

        /*
        Outer sphere physics attributes
         */
        this.el.setAttribute('dynamic-body', "shape:'sphere'; sphereRadius:" + radius + "; mass: " + data.outer + "; linearDamping: 0.5; angularDamping: 0.91;");
        this.el.setAttribute("geometry", "primitive: sphere; radius: " + radius);

        /*
        create inner sphere
         */
        innie = document.createElement('a-sphere');
        innie.id = innieID();
        this.myInnieID = innieCounter;
        innie.setAttribute('radius', "" + (data.outer / this.totalMass));
        innie.setAttribute("position", position);
        innie.setAttribute('dynamic-body', "shape:'sphere'; sphereRadius: " + (data.outer / this.totalMass) + "; mass: " + data.inner + "; linearDamping: 0.5; angularDamping: 0.5");
        this.innie = innie;
        this.innie.addEventListener('body-loaded', (function(_this) {
          return function(event) {
            var body;
            body = event.currentTarget.body;
            body.collisionResponse = true;
            body.collisionFilterGroup = 2;
            body.collisionFilterMask = 1;
            body.updateProperties();
          };
        })(this));
        this.el.parentElement.insertBefore(innie, this.el);

        /*
        create tetrahedron
         */

        /*
        create tetrahedral support points
         */
        this.controlPoints = (function() {
          var j, len, results;
          results = [];
          for (j = 0, len = tetrahedralDescription.length; j < len; j++) {
            v = tetrahedralDescription[j];
            results.push(Object.assign({}, v));
          }
          return results;
        })();
        this.myPoints = this.accessControlPoints((function(_this) {
          return function(e) {
            var mPivotPoint, p2, pivotPoint;
            pivotPoint = V2A(e.normed.multiplyScalar(radius));
            mPivotPoint = V2A(e.normed.multiplyScalar(-radius));
            p2 = V2A(e.normed.multiplyScalar(-radius));
          };
        })(this));
        if (data.debug) {
          marker = document.createElement('a-sphere');
          marker.id = innie.id + "__marker";
          marker.setAttribute("position", "0 0 0");
          marker.setAttribute("radius", "0.05");
          marker.setAttribute("color", "black");
          this.el.parentElement.insertBefore(marker, this.el);
          colors = ["#fff", "#f88", "#8F8", "#88F"];
          this.accessControlPoints((function(_this) {
            return function(e) {
              var iVector;
              iVector = document.createElement('a-entity');
              iVector.setAttribute('arrow', "direction: 1 1 1; length:1; color: " + colors[e.index]);
              iVector.id = _this.innie.id + "__innieForce__" + e.index;
              _this.el.parentElement.insertBefore(iVector, _this.el);
              iVector = document.createElement('a-entity');
              iVector.setAttribute('arrow', "direction: 1 1 1; length:1; color: " + colors[e.index]);
              iVector.id = _this.innie.id + "__outieForce__" + e.index;
              return _this.el.parentElement.insertBefore(iVector, _this.el);
            };
          })(this));
        }
        this.el.setAttribute("tetra-motor", {
          target: "#" + this.innie.id,
          minForce: 15,
          type: 'tetraForcer',
          debug: data.debug,
          pid: data.pid
        });
        this.el.addEventListener("setAction", (function(_this) {
          return function(event) {
            if (event.detail.chase) {
              _this.setPursuit(event.detail.chase);
            }
            if (event.detail.idle) {
              _this.setPursuit('idle');
            }
          };
        })(this));
        console.log("INIT", this.totalMass, radius);
      },
      update: function() {
        this.setPursuit(this.data.pursuit);
        console.log("UPDATE");
      },
      remove: function() {
        console.log("REMOVE");
      },
      pause: function() {
        console.log("PAUSE");
      },
      play: function() {
        console.log("PLAY");
      },

      /*
      Tick updated on each physics state
       */
      tick: function() {},
      tock: function() {}
    });
    window.onkeypress = function(event) {
      switch (event.key) {
        case ".":
          return commandByTeam('red', {
            chase: "self"
          });
        case ",":
          return commandByTeam('blue', {
            chase: "self"
          });
        case "n":
          commandByTeam('red', {
            chase: "#marker-red"
          });
          commandByTeam('blue', {
            chase: "#marker-blue"
          });
          return commandByTeam('green', {
            chase: "#marker-green"
          });
        case "m":
          commandByTeam('green', {
            chase: "#marker-blue"
          });
          commandByTeam('red', {
            chase: "#marker-green"
          });
          return commandByTeam('blue', {
            chase: "#marker-red"
          });
        case 'o':
          commandByTeam('blue', {
            chase: "#marker-green"
          });
          commandByTeam('green', {
            chase: "#marker-red"
          });
          return commandByTeam('red', {
            chase: "#marker-blue"
          });
      }
    };
    return commandByTeam = function(teamClass, activity) {
      var element, j, len, ref;
      ref = document.querySelectorAll('.' + teamClass);
      for (j = 0, len = ref.length; j < len; j++) {
        element = ref[j];
        element.emit('setAction', activity);
      }
    };
  })();
})();</script><div class="container right"><a-scene embedded="embedded" physics="debug: false; driver: local; gravity: -9.6; friction: 0.10; restitution: 0.300;"><a-entity physics="mass:0;" position="0 8 15" rotation="0 0 0"><a-camera physics="mass:0;" universal-controls="universal-controls" body-static="body-static" mouse-cursor="mouse-cursor" look-controls="enabled:true" wasd-controls="enabled:true"><a-cursor></a-cursor></a-camera></a-entity><a-sphere id="outie" class="blue" lowroller="debug:true; inner:4;outer:1;pursuit: 2,0;" position="-2 6 -10" radius="1" material="color:#EFff5E; transparent:true; opacity:0.3;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:9;outer:1;" position="-2 1.25 -15" radius="1.25" material="color:#EF005E; transparent:true; opacity:0.3;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-1 13 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-2 12 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-3 11 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-4 10 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-5 9 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-6 8 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-7 7 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-8 6 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-9 5 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="red" dynamic-body="" lowroller="inner:25;outer:25;pursuit: 2.2,0; pid: 200,500,1;" position="-10 4 0" radius="0.75" material="color:#ff0000; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-1 12 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-2 11 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-3 10 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-4 9 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-5 8 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-6 7 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-7 6 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-8 5 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-9 4 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="green" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 1000,300,0.0001;" position="-10 3 2" radius="0.5" material="color:#00ff00; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-1 9 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-2 8 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-3 7 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-4 6 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-5 5 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-6 4 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-7 3 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-8 2 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-9 1 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere class="blue" dynamic-body="" lowroller="inner:5;outer:1;pursuit: 2.2,0; pid: 200,400,0.1;" position="-10 0 -2" radius="0.75" material="color:#0000ff; transparent:true; opacity:0.7;"></a-sphere><a-sphere dynamic-body="" position="0 .25 -2.2" radius=".25" material="color:#EF005E; transparent:true; opacity:0.3;"></a-sphere><a-box dynamic-body="" position="0 4.5 -5" rotation="0 45 0" width="2" height="2" depth="2" color="#4CC3D9"></a-box><a-box static-body="" position="-10 3.5 -7" rotation="0 45 0" width="0.1" height="1.0" depth="0.1" color="#22CC22"></a-box><a-box static-body="" position="2 3.5 -5" rotation="0 45 0" width="0.1" height="1.0" depth="0.1" color="#4CC3D9"></a-box><a-box static-body="" position="-2 3.5 -5" rotation="0 45 0" width="0.1" height="1.0" depth="0.1" color="#4CC3D9"></a-box><a-box static-body="" position="-4 3.5 -3" rotation="0 45 0" width="0.1" height="1.0" depth="0.1" color="#4CC3D9"></a-box><a-box static-body="" position="8 3.5 -10" rotation="0 45 0" width="0.1" height="1.0" depth="0.1" color="#4CC3D9"></a-box><a-cylinder static-body="" position="-1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder><a-sky color="#cceecc"></a-sky><a-box position="-2 0 0" width="0.1" height="0.1" depth="0.1" color="yellow"></a-box><a-box position="2 0 0" width="0.1" height="0.1" depth="0.1" color="yellow"></a-box><a-box position="-3 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-3 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-3 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-3 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-3 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-2 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-2 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-2 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-2 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-2 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-1 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-1 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-1 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-1 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="-1 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="0 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="0 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="0 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="0 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="0 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="1 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="1 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="1 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="1 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="1 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="2 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="2 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="2 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="2 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="2 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="3 0 -5" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="3 0 -4" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="3 0 -3" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="3 0 -2" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-box position="3 0 -1" width="0.1" height="0.1" depth="0.1" color="green"></a-box><a-entity environment="preset: forest; dressingAmount: 500"></a-entity><a-plane static-body="" position="0  0 -4" rotation="-90 0 0" width="40" height="50" color="#7BC8A4"></a-plane><a-sphere id="marker-blue" position="-5 0 -5" radius="0.1" color="blue"></a-sphere><a-sphere id="marker-red" position="5 0 -5" radius="0.1" color="red"></a-sphere><a-sphere id="marker-green" position="0 0 0" radius="0.1" color="green"></a-sphere></a-scene></div><h3>The LowRoller version of the RollerBall</h3><div id="bloviation" class="contents"><p>Did you ever see a Samurai movie where the police take down a rampaging samuri?</p><p>They simply surrounded the samuri with wooden staffs to keep him farther than swords length, and poked him until he gave up.  we have nothing like that for a man with a gun.  Enter the LowRoller</p><p>The LowRoller rollerBall is about the size of a basketball or soccerball.  It is
covered with a hard shell with a surface like leather.  It's mass is a few kilograms.
It can alter it's center of gravity to roll around.  that's it.</p><p>Even with that limitation, it can gang up at the feet of a person causing a threat.
The random motions of the balls will make the attacker lose balance and be unable to continue.</p></div></div></div><footer class="c-card__footer"><p class="c-text--quiet">that's all--</p></footer></div></div><div class="col col-12 col-md-3"><aside id="sidebar" class="o-grid__cell o-grid__cell--width-20 p2 bg-darken-2" style="min-width:240"></aside></div><div id="sidecar" class="flex-auto order-last bg-darken-2" style="min-width:240"><div class="fb-login-button" width="200" data-width="200" data-max-rows="1" data-size="medium" data-button-type="login_with" data-show-faces="true" data-auto-logout-link="true" data-use-continue-as="true"></div><div id="fb-status"></div></div></div></div><div id="console0" class="left" data-limit="100"></div><div id="cover" style="background-image:url(/assets/images/hooray-fade2.jpg);-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH"></div></div></body></html>