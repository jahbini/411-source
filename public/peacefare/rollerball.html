<!DOCTYPE html><base href=/ ><meta content="James A. Hinds: The Celarien's best friend.  I'm not him, I wear glasses" name=author><meta content=text/html charset=UTF-8 http-equiv=Content-Type><meta content="width=device-width,initial-scale=1" name=viewport><title>A Fountainhead of Strategies, techniques and other stuff</title><meta content="Brainstorms, ideas and such" name=description><meta content="brain candy, ideas, strategies, techniques" name=keywords><script>document.styling={palx:"#03c",black:"#000",white:"#fff"}</script><link href=/assets/icons/apple-icon-57x57.png rel=apple-touch-icon sizes=57x57><link href=/assets/icons/apple-icon-60x60.png rel=apple-touch-icon sizes=60x60><link href=/assets/icons/apple-icon-72x72.png rel=apple-touch-icon sizes=72x72><link href=/assets/icons/apple-icon-76x76.png rel=apple-touch-icon sizes=76x76><link href=/assets/icons/apple-icon-114x114.png rel=apple-touch-icon sizes=114x114><link href=/assets/icons/apple-icon-120x120.png rel=apple-touch-icon sizes=120x120><link href=/assets/icons/apple-icon-144x144.png rel=apple-touch-icon sizes=144x144><link href=/assets/icons/apple-icon-152x152.png rel=apple-touch-icon sizes=152x152><link href=/assets/icons/apple-icon-180x180.png rel=apple-touch-icon sizes=180x180><link href=/assets/icons/android-icon-192x192.png rel=icon sizes=192x192 type=image/png><link href=/assets/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/assets/icons/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=/assets/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/assets/manifest.json rel=manifest><meta content=#ffffff name=msapplication-TileColor><meta content=/assets/icons/ms-icon-144x144.png name=msapplication-TileImage><meta content=#ffffff name=theme-color><link href=assets/css/vendor.css rel=stylesheet -content--encoding=gzip><link href=assets/css/app.css rel=stylesheet -content--encoding=gzip><link href=assets/icons/favicon.ico rel="shortcut icon" type=image/x-icon><link href=assets/icons/favicon.ico rel=icon type=image/x-icon><script src=allstories.json></script><script src=mystories.json></script><script src=assets/js/vendor.js -content--encoding=gzip -content--type=text/javascript></script><script src=assets/js/app.js -content--encoding=gzip -content--type=text/javascript></script><script>siteHandle="411-source",topDomain="411-source.com",require("initialize")</script><style>#cover{top:0;left:0;position:fixed;background-repeat:no-repeat;background-size:cover;z-index:-1;height:100%;width:100%}</style><script src=assets/seen.min.js></script><script src=peacefare/rollerball/cannon.js></script><script src=peacefare/rollerball/pid.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.7.1/coffee-script.min.js></script><style>.console{background:#fff;color:#000;padding:0;position:relative}.console *{border:0;font:normal 14px/1.3 Consolas,'Andale Mono','Courier New',Courier,monospace;margin:0;outline:0;padding:0}.console textarea{background:0 0;color:#000;display:block;overflow:hidden;resize:none;vertical-align:middle;width:100%;word-wrap:normal}.console-container{max-height:100%;overflow:auto}.console-container span.string{color:#c00}.console-container span.string::after,.console-container span.string::before{color:#333;content:'"'}.console-container span.number{color:#00f}.console-container span.null,.console-container span.undefined{color:#999}.console-container ol.array{display:inline-block}.console-container ol.array::before{color:#999;content:'['}.console-container ol.array::after{color:#999;content:']'}.console-container ol.array li{display:inline-block}.console-container ol.array li::after{color:#999;content:','}.console-container ol.array li:last-child::after{content:none}.console-container dl.object::before{color:#000;content:'{'}.console-container dl.object::after{color:#000;content:'}';margin-left:.5em}.console-container dl{display:inline-block}.console-container dl.object dd,.console-container dl.object dt{display:inline-block}.console-container dl.object dt{color:#909;margin-left:.5em}.console-container dl.object dt::after{color:#000;content:':';margin-right:.25em}.console-container dl.object dd::after{content:','}.console-container dl.object dd:last-child::after{content:none}.console-container div.element div.close,.console-container div.element div.open{color:#909;display:inline}.console-container div.element div.open::before{content:'<'}.console-container div.element div.close::before{content:'</'}.console-container div.element div.close::after,.console-container div.element div.open::after{content:'>'}.console-container div.element div.content{display:none}.console-container div.element dd,.console-container div.element dl,.console-container div.element dt{display:inline}.console-container div.element dt{color:#c00;margin-left:.5em}.console-container div.element dt::after{content:'='}.console-container div.element dd{color:#00f}.console-container div.element dd::after,.console-container div.element dd::before{color:#c00;content:'"'}.console-container p{padding-left:15px;position:relative}.console-container p::before{color:#ccc;content:'>';left:0;position:absolute;text-align:center;top:0;vertical-align:middle;width:15px}.console-container p.console-input::before{color:#39f}.console-container p div.command{color:#39f;white-space:pre}.console-container p.error div.result{color:red}</style><div class=fixed style="background:url(/assets/images/hooray-fade2.jpg) no-repeat center fixed;-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH"></div><div class="bg-transparent container-fluid" id=411-source-body><div class=row></div><div class=row style=min-height:100vh><div class=row><div class="col col-12 col-md-9" id=storybar><div class="bg-silver u-shadow" id=mainline><header class=c-card__header><h2 class="c-heading c-heading--small">Rollerball Spring<div class=c-heading__sub>---</div></h2></header><div class=c-card__body><div class="bg-darken-1 m1"><h3>The LowRoller version of the RollerBall</h3><div class=contents id=bloviation><p>Did you ever see a Samuri movie where the police take down a rampaging samuri?<p>They simply surrounded the samuri with wooden staffs to keep him farther than swords length, and poked him until he gave up. we have nothing like that for a man with a gun. Enter the LowRoller<p>The LowRoller rollerBall is about the size of a basketball or soccerball. It is covered with a hard shell with a surface like leather. It's mass is a few kilograms. It can alter it's center of gravity to roll, hop or bounce. that's it.<p>Even with that limitation, it can gang up at the feet of a person causing a threat. The random motions of the balls will make the attacker lose balance and be unable to continue.<p>Press the spacebar to start and stop the simulation. The large ball is a meter in diameter. press '.' to single step the simulation.</div><div class=contents id=bloviation><form class=flex-container id=sliders></form><canvas height=400 id=seen-canvas width=400></canvas><p>Press hjkl to change where these rollerballs take down an attacker.<p>Rotate the view with click and drag. Zoom with fingers or mouse wheel.</div></div></div><footer class=c-card__footer><p class=c-text--quiet>that's all--</footer></div></div><div class="col col-12 col-md-3"><aside class="bg-darken-2 o-grid__cell o-grid__cell--width-20 p2" id=sidebarx style=min-width:240></aside></div><div class="bg-darken-2 flex-auto order-last" id=sidecar style=min-width:240><div class=fb-login-button data-auto-logout-link=true data-button-type=login_with data-max-rows=1 data-show-faces=true data-size=medium data-use-continue-as=true data-width=200 width=200></div><div id=fb-status></div></div></div></div><div id=console0 data-limit=10></div><script>(function() {
  var slice = [].slice,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };
  (function() {
  var FLIPXZ, FLIPYZ, RollerBall, TetraForcer, allBall, avatar, balls, bind, console, context, dragger, dropTime, floor, groundBody, groundShape, height, j, leather, m, n, onceStop, scene, seenModel, simulateThem, startStop, timeStamp, width, world, x, xform, y, zoomer;
  T = Pylon.Halvalla;
  bind = function(func, inst) {
    var args;
    args = toArray(arguments).slice(2);
    return function() {
      func.apply(inst || this, args.concat(toArray(arguments)));
    };
  };
  (function() {    //include console
    var Console, History, addClass, consoles, create, extend, listen, output, text, toArray, typeOf;
    consoles = {};
    
    //include console
    History = function() {
      var history, index;
      index = -1;
      history = [];
      return extend(this, {
        clear: function() {
          history = [];
        },
        reset: function() {
          index = history.length;
        },
        previous: function() {
          return history[index = Math.max(--index, 0)];
        },
        next: function() {
          return history[index = Math.min(++index, history.length)];
        },
        push: function(data) {
          if (history[history.length - 1] !== data) {
            history.push(data);
            this.reset();
          }
        }
      });
    };
    Console = function(el, scope) {
      var console, container, exec, history, input, inputContainer, jsonize, limbo, log, node, original;
      jsonize = function(msg) {
        var serializer, stringify;
        stringify = function(obj, replacer, spaces, cycleReplacer) {
          return JSON.stringify(obj, serializer(replacer, cycleReplacer), spaces);
        };
        serializer = function(replacer, cycleReplacer) {
          var keys, stack;
          stack = [];
          keys = [];
          if (cycleReplacer === null) {
            cycleReplacer = function(key, value) {
              if (stack[0] === value) {
                return '[Circular ~]';
              }
              return '[Circular ~.' + keys.slice(0, stack.indexOf(value)).join('.') + ']';
            };
          }
          return function(key, value) {
            var thisPos;
            if (stack.length > 0) {
              thisPos = stack.indexOf(this);
              if (~thisPos) {
                stack.splice(thisPos + 1);
              } else {
                stack.push(this);
              }
              if (~thisPos) {
                keys.splice(thisPos, 2e308, key);
              } else {
                keys.push(key);
              }
              if (~stack.indexOf(value)) {
                value = cycleReplacer.call(this, key, value);
              }
            } else {
              stack.push(value);
            }
            if (replacer === null) {
              return value;
            } else {
              return replacer.call(this, key, value);
            }
          };
        };
      };
      log = function(level) {
        var children, elT, firstElement, max, msg, result;
        msg = arguments.length === 2 ? arguments[1] : toArray(arguments).slice(1);
        result = create('div', {
          'class': 'result'
        }, output(msg));
        elT = addClass(create('p', null, result), typeOf(msg), level);
        firstElement = container.firstChild;
        container.insertBefore(elT, container.firstChild);
        children = container.childNodes;
        max = container.parentNode.dataset.limit || 20;
        while (children.length > max) {
          container.removeChild(children[children.length - 2]);
        }
        return elT;
      };
      exec = function(command) {
        var cmd, elT, err, level, msg;
        if (!command) {
          return;
        }
        cmd = text(create('div', {
          'class': 'command'
        }), command);
        level = 'info';
        msg = void 0;
        try {
          msg = (function(scope) {
            return eval(command);
          }).call(scope);
        } catch (error) {
          err = error;
          msg = err;
          level = 'error';
        }
        elT = log(level, msg);
        elT.insertBefore(cmd, elT.childNodes[0]);
        elT.scrollTop = elT.scrollHeight;
        container.scrollTop = container.scrollHeight;
        history.push(command);
      };
      if (typeof el === 'string') {
        el = document.getElementById(el);
      }
      console = consoles[el];
      if (console) {
        console.cd(scope);
        return console;
      } else if (!(this instanceof Console)) {
        if (!console) {
          console = new Console(el, scope);
        }
        return console;
      }
      consoles[el] = this;
      scope || (scope = window);
      limbo = create('div');
      while (node = el.childNodes[0]) {
        limbo.appendChild(node);
      }
      container = create('div', {
        'class': 'console-container'
      });
      inputContainer = create('p', {
        'class': 'console-input'
      });
      input = create('textarea', {
        row: 1
      });
      original = {
        className: el.className,
        tabIndex: el.tabIndex
      };
      inputContainer.appendChild(input);
      container.appendChild(inputContainer);
      addClass(el, 'console').appendChild(container);
      if (el.tabIndex < 0) {
        el.tabIndex = 0;
      }
      listen(el, 'focus', function() {
        input.focus();
      });
      history = new History();
      listen(input, 'keydown', function(event) {
        var cmd;
        switch (event.keyCode) {
          case 13:
            // enter
            event.preventDefault();
            exec(this.value);
            this.value = '';
            return false;
          case 38:
            // up
            if (cmd = history.previous()) {
              input.value = cmd;
            }
            event.preventDefault();
            return false;
          case 40:
            // down
            if (cmd = history.next()) {
              input.value = cmd;
            } else {
              input.value = '';
            }
            event.preventDefault();
            return false;
        }
      });
      listen(input, 'blur', function() {
        history.reset();
      });
      return extend(this, {
        cd: function(s) {
          scope = s;
        },
        setDepth: (d) => {
          return this.depth = d;
        },
        log: function() {
          this.info.apply(this, arguments);
        },
        info: bind(log, this, 'info'),
        warn: bind(log, this, 'warn'),
        error: bind(log, this, 'error'),
        clear: function() {
          var el;
          var elT, prev;
          prev = inputContainer.previousSibling;
          while (prev) {
            elT = prev;
            prev = elT.previousSibling;
            elT.parentNode.removeChild(elT);
          }
        },
        destroy: function() {
          var k;
          for (k in original) {
            el[k] = original[k];
          }
          while (node = el.childNodes[0]) {
            el.removeChild(node);
          }
          while (node = limbo.childNodes[0]) {
            el.appendChild(node);
          }
        }
      });
    };
    // delete limbo;
    // delete output;
    // delete input;
    // delete original;
    create = function(tagName, attrs) {
      var el, i, k;
      el = document.createElement(tagName);
      if (attrs) {
        for (k in attrs) {
          el.setAttribute(k, attrs[k]);
        }
      }
      i = 2;
      while (i < arguments.length) {
        el.appendChild(arguments[i]);
        ++i;
      }
      return el;
    };
    text = function(el, text) {
      if (typeof el === 'string' || typeof el === 'number') {
        return document.createTextNode(el);
      }
      el.appendChild(document.createTextNode(text));
      return el;
    };
    addClass = function(el) {
      var i;
      var classes, i;
      classes = [];
      i = 1;
      while (i < arguments.length) {
        classes = classes.concat(arguments[i].split(/\s+/));
        ++i;
      }
      if (el.classList) {
        for (i in classes) {
          el.classList.add(classes[i]);
        }
      } else {
        classes = el.className.split(/\s+/).concat(classes);
        el.className = classes.join(' ');
      }
      return el;
    };
    listen = function(el, event, callback) {
      var onevent;
      onevent = 'on' + event;
      if (el.addEventListener) {
        return el.addEventListener(event, callback, false);
      } else if (el.attachEvent) {
        return el.attachEvent(onevent, callback);
      } else if (onevent in el) {
        return el[onevent] = callback;
      }
    };
    extend = function(src) {
      var i, k, obj;
      i = 1;
      while (i < arguments.length) {
        obj = arguments[i];
        for (k in obj) {
          src[k] = obj[k];
        }
        ++i;
      }
      return src;
    };
    toArray = function(arr) {
      return Array.prototype.slice.call(arr);
    };
    bind = function(func, inst) {
      var args;
      args = toArray(arguments).slice(2);
      return function() {
        func.apply(inst || this, args.concat(toArray(arguments)));
      };
    };
    typeOf = function(obj) {
      if (Object.prototype.toString.call(obj) === '[object Array]') {
        return 'array';
      } else if (Object.prototype.toString.call(obj) === '[object Error]') {
        return 'error';
      } else if (obj === null) {
        return 'null';
      } else if (obj && obj.nodeType === 1) {
        return 'element';
      } else {
        return typeof obj;
      }
    };
    output = function(result, deep = this.depth) {
      var val;
      var i;
      var arr, attr, attrs, close, html, i, k, nodeName, obj, open, type, val;
      type = typeOf(result);
      switch (type) {
        case 'null':
        case 'undefined':
          return create('span', {
            'class': type
          }, text(type));
        case 'array':
          arr = create('ol', {
            'class': type
          });
          for (i in result) {
            val = result[i];
            arr.appendChild(create('li', null, output(val, deep - 1)));
          }
          return arr;
        case 'object':
          obj = create('dl', {
            'class': type
          });
          for (k in result) {
            if (!(k in result.__proto__)) {
              val = deep === 0 ? text(k) : output(result[k], deep - 1);
              obj.appendChild(create('dt', null, text(k)));
              obj.appendChild(create('dd', null, val));
            }
          }
          return obj;
        case 'element':
          nodeName = result.nodeName.toLowerCase();
          attrs = create('dl');
          open = create('div', {
            'class': 'open'
          }, text(nodeName), attrs);
          close = create('div', {
            'class': 'close'
          }, text(nodeName));
          html = create('div', {
            'class': 'content'
          }, text(result.innerHTML));
          i = 0;
          while (i < result.attributes.length) {
            attr = result.attributes[i];
            attrs.appendChild(create('dt', null, text(attr.name)));
            attrs.appendChild(create('dd', null, text(attr.value)));
            ++i;
          }
          return create('div', {
            'class': type
          }, open, html, close);
        case 'number':
          return create('span', {
            'class': type
          }, text(result.toFixed(2)));
        default:
          return create('span', {
            'class': type
          }, text(result.toString()));
      }
    };
    Console.log = function() {};
    window.Console = Console;
  })();
  TetraForcer = (function() {
    var MINFORCE;

    
    class TetraForcer {
      constructor(body, e1) {
        /*
          Pylon.on "slider-#{@e.index}:jam", (event)=>
            @jam event.value
          @shifter = 0    
          Pylon.on "slider-#{@e.index}:shift", (event)=>
            @shifter = event.value  
          return
        jam: (forceValue) => # the real world position
          @jamming = true
          @jamForce = forceValue
          */
        this.seek = this.seek.bind(this);
        this.e = e1;
        this.tetraPoint = this.e.cannonLocal;
        this.outerSphere = body.outerSphere;
        this.innerSphere = body.innerSphere;
        this.body = body;
        this.seekerPID = new PID(-100, 1, -0.1, 1 / 60.0);
        this.seekerPID.setTarget = 0;
        this.seek = bind(this.seek, this);
        this.jamming = false;
        this.jamForce;
        return;
      }

      seek(pursuit) { // the real world position
        var adjust, force, seekPosition, seekVector, tetraPosition, tetraVector;
        pursuit.z = this.body.radius * 2;
        seekVector = pursuit.vsub(this.outerSphere.position);
        seekPosition = this.outerSphere.position.vadd(seekVector.unit().scale(this.body.radius * .8));
        tetraPosition = this.outerSphere.pointToWorldFrame(this.tetraPoint);
        force = MINFORCE;
        this.tetraToPursuit = pursuit.distanceTo(tetraPosition);
        this.tetraToPursuit = seekPosition.distanceTo(tetraPosition);
        this.toInnie = this.innerSphere.position.distanceTo(seekPosition);
        this.innieToPursuit = pursuit.distanceTo(this.innerSphere.position);
        this.tetraToInnie = tetraPosition.distanceTo(this.innerSphere.position);
        if (this.tetraToPursuit < this.tetraToInnie) {
          adjust = this.toInnie;
        } else {
          //debugger
          //if @body.A == "Biggie"
          //  console.log @e.viewAttributes.name,adjust
          adjust = 0;
        }
        adjust = this.seekerPID.update(adjust);
        if (this.jamming) {
          this.force = force + (this.jamForce - 128) / 255;
        } else {
          this.force = force + adjust;
        }
        tetraVector = (tetraPosition.vsub(this.innerSphere.position)).unit().scale(this.body.mass);
        this.innerSphere.applyForce(tetraVector.scale(this.force), this.innerSphere.position);
        this.outerSphere.applyForce(tetraVector.scale(this.force * -1), tetraPosition);
      }

    };

    MINFORCE = 25;

    return TetraForcer;

  }).call(this);
  RollerBall = (function() {
    var C, TETRAHEDRON_COORDINATE_MAP, tetrahedralDescription, tetrahedralSphere, tetrahedronPoints, toPoint, toVec3;

    //Pylon.trigger "slider-#{@e.index}:watch",@force
    class RollerBall {
      
        // create a seen Model of inner and outer seen sphereish shapes decorated
      // with cannon mass objects connected by tetrahedral force positions
      accessControlPoints(f) {
        var element, j, len, ref, results;
        ref = this.controlPoints;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          element = ref[j];
          results.push(f(element));
        }
        return results;
      }

      setPursuit(x, y) {
        var marker, p1, p2;
        this.pursuit = new CANNON.Vec3(x, y, -10);
        p1 = toPoint(this.pursuit);
        p1.z = 2; // lower limit is 2 meters
        p2 = p1.copy().add(seen.P(0, 0, 5));
        marker = seen.Shapes.pipe(p1, p2, 0.3, 6);
        this.avatar.add(marker.fill(new seen.Material(seen.C(20, 20, 20))));
      }

      // mass in kg, distance in meters
      constructor(name, world, mass = 1, radius = 0.2, options = {}) {
        var colorHex, defaultOptions, hull, tetraNames, v;
        this.accessControlPoints = this.accessControlPoints.bind(this);
        //e.strut.scale size
        //e.pipe.translate t.x,t.y,t.z
        //console.log e.pipe
        this.clear = this.clear.bind(this);
        this.A = name;
        this.world = world;
        this.scene = world.scene;
        this.avatar = world.scene.model;
        this.mass = mass;
        this.radius = radius;
        this.setPursuit(0, 0);
        this.controlPoints = (function() {
          var j, len, results;
          results = [];
          for (j = 0, len = tetrahedralDescription.length; j < len; j++) {
            v = tetrahedralDescription[j];
            results.push(Object.assign({}, v));
          }
          return results;
        })();
        defaultOptions = {
          massRatio: 0.1,
          innerRatio: 0.1,
          position: seen.P(),
          detail: false,
          sliders: false
        };
        this.config = Object.assign({}, defaultOptions, options);
        this.innerSphere = new CANNON.Body({
          mass: this.mass * (1 - this.config.massRatio),
          position: this.config.position,
          shape: new CANNON.Sphere(this.radius * this.config.innerRatio)
        });
        this.outerSphere = new CANNON.Body({
          mass: this.mass * this.config.massRatio,
          angularDamping: 0.1,
          position: this.config.position,
          shape: new CANNON.Sphere(this.radius)
        });
        //debugger
        this.innerSphere.aName = `${this.A}.Innie`;
        //@innerSphere.collisionResponse=false
        this.innerSphere.collisionFilterGroup = 1;
        this.innerSphere.collisionFilterMask = 1;
        this.outerSphere.aName = `${this.A}.Outie`;
        this.outerSphere.collisionFilterGroup = 2;
        this.outerSphere.collisionFilterMask = 2;
        this.world.addBody(this.innerSphere);
        this.world.addBody(this.outerSphere);
        
        // build up an array of structures for the anchor points
        this.accessControlPoints((e) => {
          return e.tetraForcer = new TetraForcer(this, e);
        });
        
        // set up simulation-step update routine for feint and final position force
        world.addEventListener("preStep", (event) => {
          var who;
          who = this.A;
          this.accessControlPoints((e) => {
            return e.tetraForcer.seek(this.pursuit);
          });
        });
        world.addEventListener("postStep", (event) => {
          this.innerSphere.velocity.scale(.97, this.innerSphere.velocity);
          this.outerSphere.velocity.scale(.98, this.outerSphere.velocity);
        });
        // end of physical simulation stuf

        //visual (avatar) stuff
        // create seen model for outerHull & it's decorations
        this.outerHull = new seen.Model();
        //@.outerHull.add hull=seen.Shapes.sphere().scale(@radius*10).fill new seen.Material seen.C 200,200,20,200
        this.outerHull.add(hull = seen.Shapes.sphere().scale(this.radius * 10).fill(new seen.Material(seen.C(200, 200, 20, 200))));
        this.outerHull.bake();
        this.avatar.add(this.outerHull);
        if (!this.config.detail) {
          return;
        }
        // scene model for the control force tetrahedron 
        this.avatar.add(this.innerHull = seen.Shapes.tetrahedron().scale(10 * this.radius * this.config.innerRatio).stroke(new seen.Material(seen.C(20, 200, 200, 200))));
        this.innerHull.fill(new seen.Material('hsla(0,0,0,1)'));
        this.innerHull.bake();
        tetraNames = ["orange", "blue", "green", "violet"];
        colorHex = ["#FDD459", "#46e1d4", "#24C52B", "#C31A96"];
        this.accessControlPoints(function(e) {
          return e.viewAttributes = {
            name: tetraNames[e.index],
            color: colorHex[e.index]
          };
        });
        this.accessControlPoints((e) => { // creaate the four struts
          var el, pInner, pOuter, rc, strut, what;
          pInner = e.p.copy().multiply(5 * this.radius * this.config.innerRatio);
          pOuter = e.p.copy().multiply(5 * this.radius);
          strut = seen.Shapes.pipe(pOuter, pInner, 0.1, 3);
          strut.name = e.viewAttributes.name;
          e.strut = strut;
          rc = seen.Colors.parse(e.viewAttributes.color);
          rc.a = 128;
          this.avatar.add(strut.fill(new seen.Material(rc)));
          if (!this.config.sliders) {
            return;
          }
          el = document.getElementById('sliders');
          //debugger
          what = document.createElement("div");
          what.innerHTML = T.render(function() {
            var ident;
            ident = `slider-${e.index}`;
            T.input(`#${ident}`, {
              type: "range",
              min: 0,
              max: 255,
              oninput: `Pylon.trigger('${ident}:jam',this);`
            });
            T.label({
              for: ident
            }, e.viewAttributes.name);
            T.input(`#${ident}-watch.right`, {
              type: "range",
              min: 0,
              max: 255
            });
            return T.input(`#${ident}-shift.right`, {
              type: "range",
              min: 0,
              max: 255,
              oninput: `Pylon.trigger('${ident}:shift',this);`
            });
          });
          el.appendChild(what);
          return Pylon.on(`slider-${e.index}:watch`, (f) => {
            el = document.getElementById(`slider-${e.index}-watch`);
            el.value = f * 7 - 128;
          });
        });
        return;
      }

      // end setup
      // visual updates for innie and outie
      update() {
        var pi, po, pr, rotation, who;
        who = this.A;
        // map the physics simulation objects to seen's visual toolkit
        po = toPoint(this.outerSphere.position);
        pr = this.outerSphere.quaternion;
        rotation = new seen.Quaternion(pr.x, pr.y, pr.z, pr.w);
        //console.log "outie",po
        this.outerHull.reset().transform(rotation.toMatrix());
        this.outerHull.translate(po.x, po.y, po.z);
        if (!this.config.detail) {
          return;
        }
        pi = toPoint(this.innerSphere.position);
        //console.log "innie",pi
        this.innerHull.reset().transform(rotation.toMatrix());
        this.innerHull.translate(pi.x, pi.y, pi.z);
        this.accessControlPoints((e) => {
          var angle, bottom, ls, obtuse, perp, r, size, top, vio, viol, vis, visl, vos, vosl, wi, wo, ws;
          // vio,vos,vis vector sides of triangles
          // l == local frame
          // w == world frame
          // wi inner, wo outer, ws strut
          vio = (wo = this.innerSphere.position).vsub((wi = this.outerSphere.position));
          ls = e.cannonLocal.unit().scale(this.radius);
          ws = this.outerSphere.pointToWorldFrame(ls);
          vos = wo.vsub(ws);
          vis = wi.clone().vsub(ws);
          perp = vis.cross(vos);
          perp.normalize();
          visl = vis.length();
          vosl = vos.length();
          viol = vio.length();
          top = visl * visl + vosl * vosl - viol * viol;
          bottom = 2 * visl * vosl;
          angle = Math.acos(top / bottom);
          obtuse = viol > vosl + visl;
          if (obtuse) {
            if (angle < Math.PI) {
              angle = Math.PI * 2 - angle;
            }
          } else {
            if (angle > Math.PI) {
              angle = Math.PI * 2 - angle;
            }
          }
          if (e.tetraForcer.shifter) {
            
            //what does angle do
            angle = 2 * Math.PI * e.tetraForcer.shifter / 255;
          }
          r = seen.Quaternion.axisAngle(perp.x, perp.y, perp.z, angle);
          size = this.radius * 5 * (1 - this.config.innerRatio);
          //rotator = rotator.multiply rotation
          //debugger
          e.strut.reset();
          r = r.multiply(rotation).toMatrix(); //if e.index == 3
          //e.strut.translate -ls.x*10,-ls.y*10,-ls.z*10
          e.strut.transform(r);
          e.strut.translate(wo.x * 10, wo.y * 10, wo.z * 10);
        });
      }

      clear() {
        return this.accessControlPoints(function(e) {
          e.tetraForcer.shifter = 0;
          e.tetraForcer.jamming = false;
        });
      }

    };

    
    // utility to convert points to/from cannon from/to seen
    toVec3 = function(p) {
      return new CANNON.Vec3(p.x / 10, p.y / 10, p.z / 10);
    };

    toPoint = function(v) {
      return seen.P(v.x * 10, v.y * 10, v.z * 10);
    };

    C = function(x = 0, y = 0, z = 0) {
      return new CANNON.Vec3(x, y, z);
    };

    TETRAHEDRON_COORDINATE_MAP = [[0, 2, 1], [0, 1, 3], [3, 2, 0], [1, 2, 3]];

    // the raw values of the tetrahedron points -- useful in several places
    tetrahedronPoints = [seen.P(1, 1, 1), seen.P(-1, -1, 1), seen.P(-1, 1, -1), seen.P(1, -1, -1)];

    
    // algorithmic generation
    tetrahedralDescription = [];

    (function() {
      var j, len, len1, n, r, y, z;
      r = [1, -1];
      for (j = 0, len = r.length; j < len; j++) {
        z = r[j];
        for (n = 0, len1 = r.length; n < len1; n++) {
          y = r[n];
          tetrahedralDescription.push({
            p: seen.P(z * y, y, z),
            raw: [z * y, y, z],
            cannonLocal: C(z * y, y, z),
            index: tetrahedralDescription.length,
            flip: 1
          });
        }
      }
    })();

    
    // tetrasphere -- a spherical hull with tetrahedral attachment points

    tetrahedralSphere = function(subdivisions = 2) {
      var i, j, len, len1, n, o, p, ref, triangle, triangles;
      triangles = TETRAHEDRON_COORDINATE_MAP.map(function(coords) {
        return coords.map(function(c) {
          return tetrahedronPoints[c];
        });
      });
      for (i = j = 0, ref = subdivisions; (0 <= ref ? j < ref : j > ref); i = 0 <= ref ? ++j : --j) {
        triangles = seen.Shapes._subdivideTriangles(triangles);
        for (n = 0, len = triangles.length; n < len; n++) {
          triangle = triangles[n];
          for (o = 0, len1 = triangle.length; o < len1; o++) {
            p = triangle[o];
            p.normalize();
          }
        }
      }
      // return a unit sphereical hull of triangles -- points 0 through 3 are the original
      // attachment points on the unit sphere
      return new seen.Shape('tetrahedralSphere', triangles.map(function(triangle) {
        return new seen.Surface(triangle.map(function(v) {
          return v.copy();
        }));
      }));
    };

    window.bind1 = bind; //hack to make coffeeescript autogenerated bind1 equiv to bind

    return RollerBall;

  }).call(this);
  console = Console("console0", window);
  // Setup our world
  world = new (CANNON.World)();
  // m/s²
  world.gravity.set(0, 0, -9.82);
  leather = new CANNON.Material({
    friction: .3,
    restitution: 0.3
  });
  world.defaultMaterial.friction = 0.3;
  world.defaultMaterial.restitution = 0.3;
  // Create a plane
  groundBody = new CANNON.Body({
    mass: 0
  });
  groundShape = new (CANNON.Plane)();
  groundBody.addShape(groundShape);
  groundBody.aName = "floorie";
  groundBody.collisionFilterGroup = -1;
  groundBody.collisionFilterMask = -1;
  world.addBody(groundBody);
  width = 400;
  height = 400;
  // Create scene and add shape to model
  world.scene = scene = new seen.Scene({
    model: seen.Models.default(),
    viewport: seen.Viewports.center(width, height),
    shader: seen.Shaders.Flat
  });
  avatar = world.scene.model;
  balls = [];
  allBall = function(r) {
    var b, j, len, results;
    results = [];
    for (j = 0, len = balls.length; j < len; j++) {
      b = balls[j];
      results.push(r(b));
    }
    return results;
  };
  balls.push(new RollerBall("Biggie", world, 100, 0.50, {
    detail: true,
    position: new CANNON.Vec3(1, 1, 0.75)
  }));
  //balls.push new RollerBall "mannie",world,10,0.30, position:new CANNON.Vec3 1,1.3,5
  //balls.push new RollerBall "moe",world,10,0.30, position:new CANNON.Vec3 0,1.3,4
  //balls.push new RollerBall "jack",world,10,0.30, position:new CANNON.Vec3 1.2,1.3,6
  xform = seen.M().rotx(.3).scale(3);
  scene.camera.transform(xform).bake();
  floor = seen.Shapes.patch(50, 50);
  floor.translate(-25, -25, 0);
  floor.roty(Math.PI);
  floor.fill(new seen.Material(seen.C(100, 100, 100, 100)));
  floor.eachSurface(function(s) {
    return s.cullBackfaces = false;
  });
  avatar.add(floor.scale(-50));
//put some easily recognizable grid elements
  for (x = j = -5; j <= 5; x = ++j) {
    for (y = n = -5; n <= 5; y = ++n) {
      avatar.add(seen.Shapes.pipe(seen.P(x * 10, y * 10, 1), seen.P(x * 10, y * 10, 0), 0.5));
    }
  }
  
  // Create render context from canvas
  context = seen.Context('seen-canvas', scene).render();
  //context.layer(new seen.FillLayer(width, height, '#0005'))
  //debugger
  FLIPXZ = new seen.Matrix([0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1]);
  FLIPYZ = new seen.Matrix([1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1]);
  scene.model.transform(FLIPYZ);
  scene.model.rotx(Math.PI * 20 / 360);
  scene.model.bake();
  timeStamp = 0;
  startStop = false;
  onceStop = false;
  dropTime = 10000;
  simulateThem = function(t, dt) {
    var again, fixedTimeStep, last, lastTime, maxSubSteps, now;
    now = Date.now();
    fixedTimeStep = 1.0 / 60.0;
    // seconds
    maxSubSteps = 3;
    lastTime = void 0;
    if (t > dropTime & balls.length < 14) {
      dropTime = t + fixedTimeStep * 100000;
      //console.log "pushing new ball",t
      balls.push(new RollerBall(`jack_${dropTime}`, world, 10, 0.30, {
        position: new CANNON.Vec3(4, 4, 6)
      }));
    }
    if (startStop) {
      if (onceStop) {
        startStop = false;
        onceStop = false;
      }
      //allBall (b)->console.log b.A,b.outerSphere.position,b.innerSphere.position
      //debugger
      world.step(fixedTimeStep, dt, maxSubSteps);
    }
    //console.log fixedTimeStep,dt,t
    again = Date.now();
    
    timeStamp += dt * 1e-2;
    allBall(function(b) {
      return b.update();
    });
    last = Date.now();
  };
  //console.log last-again, again-now
  m = Pylon.Mithril;
  seenModel = scene.model.append();
  // Add mouse-rotate
  dragger = new seen.Drag('seen-canvas', {
    inertia: true
  });
  dragger.on('drag.rotate', function(e) {
    xform = seen.Quaternion.xyToTransform(...e.offsetRelative);
    return scene.camera.transform(xform);
  });
  // Add mousewheel-zoom
  zoomer = new seen.Zoom('seen-canvas', {
    smooth: false
  });
  zoomer.on('zoom.scale', function(e) {
    xform = seen.M().scale(e.zoom);
    return scene.camera.transform(xform);
  });
  context.animate().onBefore(simulateThem).start();
  return window.onkeypress = function(event) {
    switch (event.key) {
      case ".":
        onceStop = true;
        startStop = true;
        break;
      case ' ':
        startStop = !startStop;
        break;
      case 'h':
        allBall(function(b) {
          return b.setPursuit(-5, 0);
        });
        break;
      case 'j':
        allBall(function(b) {
          return b.setPursuit(4, 4);
        });
        break;
      case 'k':
        allBall(function(b) {
          return b.setPursuit(-3, -3);
        });
        break;
      case 'l':
        allBall(function(b) {
          return b.setPursuit(0, 0);
        });
        break;
      case 'c':
        allBall(function(b) {
          return b.clear();
        });
    }
  };
})();
})();</script><div id=cover style=background-image:url(/assets/images/hooray-fade2.jpg);-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;ms-filter:FlipH></div></div>